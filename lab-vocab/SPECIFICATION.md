# ラブラドール学習帳 仕様書

**バージョン:** 52.0
**ターゲット:** Web / PWA
**アーキテクチャ:** マルチページアプリケーション (MPA) / 静的ホスティング

## 1. ファイル構成
- `index.html`: ホーム画面（エントリポイント）
- `quiz.html`: クイズ画面
- `priming.html`: 事前学習画面
- `result.html`: 結果画面
- `list.html`: 単語一覧画面
- `settings.html`: 詳細設定画面
- `style.css`: 共通スタイル
- `app.js`: 共通ロジック（データ読み込み、SRS、セッション管理）
- `words/`: 学習データソースディレクトリ
  - `lists.csv`: データセット一覧定義ファイル
  - `*.csv`: 個別の単語データセット（例: `ngsl.csv`, `ielts3500-basic1000.csv`）
- `Dog.json`: Lottieアニメーションデータ

## 2. データ管理
- **マスターデータ**: `localStorage`。キーはデータセットファイル名に基づき生成される（例: `ngsl.csv` -> `lab_data_v30` (互換性のため), `ielts3500-basic1000.csv` -> `lab_data_ielts`）。
- **データセット定義**: `words/lists.csv` を読み込み、利用可能な単語帳リストを動的に構築する。
  - `lists.csv` のカラム: `file name`, `description`
- **データフォーマット**:
  - 各CSVファイル（`lists.csv`含む）は、全フィールドがダブルコーテーションで囲まれた形式（`"field1","field2",...`）であること。
  - 単語CSVの1行目はヘッダ行（`番号,単語,訳,品詞,例文,訳文`）とし、データは2行目から開始する。
  - **ID生成**: 1列目（番号）に有効な正の整数がある場合はそれをIDとして使用する。ない場合や無効な場合は、1からの連番を使用する。
  - カンマを含むデータ（例文など）も、ダブルコーテーションで囲むことで正しくパースされる。
- **初回ロード**: 選択中のCSVをフェッチし、空であれば `localStorage` を初期化。
- **永続化**: すべての進捗は `localStorage` に保存される。
- **セッション**: `sessionStorage` を使用して、クイズキュー、結果、および学習設定（`lab_session_config`）を管理する。

## 3. UI/UX 仕様

### 3.1 共通デザイン
- **ヘッダー**: 画面タイトル（左） + ホームボタン（右、アイコンのみ）。
  - クイズ画面、事前学習画面、結果画面、一覧画面、設定画面すべてに配置。
- **フッター**: 全画面共通で、画面下部に「ホームへ戻る」等のボタンを配置。
- **テーマカラー**: #F4D03F (プライマリ), #5D4037 (テキスト), #FAF9F6 (背景)。
  - ホーム画面の背景色はテーマカラー（#F4D03F）を使用。

### 3.2 ホーム画面 (`index.html`)
- **ヘッダー**: 「ラブラドール学習帳」（絵文字なし）。
- **ビジュアル**:
  - メッセージ「単語を覚えると仲良くなれるよ」。
  - Lottieアニメーション (`Dog.json`) + 親密度ハートメーター（10個）。
  - **親密度メッセージ**:
    - ハートの数（親密度）に応じて、タップ時の犬のセリフが変化。「大好きだワン！」「ずっと一緒だよ！」など愛情表現が豊かになる。
    - **不定期メッセージ**: 5〜15秒のランダムな間隔で、自動的にメッセージが表示される。
- **グラフ**: 「学習効果の持続期間に合わせた出題方法」の分布表示。
  - タイトルをクリックすると独自デザインのモーダルで「レベル別出題形式」のヘルプを表示。
  - レベル定義：Lv.0(未学習)、Lv.1(1日)、Lv.2(3日)、Lv.3(1週)、Lv.4(2週)、Lv.5(1ヶ月)。
- **設定**: モード（復習/新規）、出題数（10/20）、事前学習（ON/OFF）。
- **デバッグ機能**: 削除。
- **バージョン情報**: フッター最下部に表示。

### 3.3 単語一覧画面 (`list.html`)
- **タイトル**: 「全単語一覧」。
- **リスト表示**:
  - 1行目: ID, 英単語
  - 2行目: [品詞] 日本語訳
  - 品詞バッジは日本語訳の左側に配置。

### 3.4 事前学習画面 (`priming.html`)
- **リスト表示**:
  - 1行目: 英単語
  - 2行目: [品詞] 日本語訳 + 音声ボタン
  - 品詞バッジは日本語訳の左側に配置。

### 3.5 クイズ画面 (`quiz.html`)
- **ヘッダー**: プログレスバー（上部）、進捗状況（左）、ホームボタン（右）。
- **カードレイアウト**: 英単語（上） + 品詞バッジ（下/小）。縦並び。
- **回答演出**:
  - 選択肢クリック時、即座に正誤判定色（正解：緑、不正解：赤）を適用。
- **機能**:
  - マスク機能（目のアイコン）。
  - 音声再生（スピーカーアイコン）。
  - 中断ボタン（確認ダイアログ表示後にホームへ）。
  - 連打防止機能（回答処理中のクリック無効化）。

### 3.6 結果画面 (`result.html`)
- **レイアウト**:
  - 上部: 「記憶定着期間の変動」グラフを表示（前回からの変動を +/- で強調表示）。
  - 中央: 結果リスト（スクロール可能）。
  - 下部: 「もう一度」ボタン + 「ホームへ戻る」ボタン。
- **リトライ機能**:
  - 「もう一度」ボタン押下時、**直前の学習設定（モード、出題数、事前学習ON/OFF）を維持したまま**、新しいセッションを開始する。

### 3.7 詳細設定画面 (`settings.html`)
- **単語帳選択**: `lists.csv` に定義されたデータセットをプルダウンから選択可能。
- **データ管理**: 現在選択中の単語帳の学習データをリセットする機能。

## 4. ロジック仕様

### 4.1 アダプティブクイズ (レベル別出題)
- **Lv.0-1 (Standard)**: 英→日。
- **Lv.2 (Masked)**: 英→日 (英単語非表示)。
- **Lv.3 (Reverse)**: 日→英。
- **Lv.4-5 (Fill-in)**: 例文穴埋め。

### 4.2 SRS (間隔反復) アルゴリズム
- **正解**: レベルアップ（最大5）、復習間隔を以下のように設定。
  - Lv.1: 1日
  - Lv.2: 3日
  - Lv.3: 1週
  - Lv.4: 2週
  - Lv.5: 1ヶ月
- **不正解**: レベルリセット（0）、復習間隔を0.5日にリセット。

### 4.3 親密度 (Affinity) システム
- 全単語の合計レベルに基づいて算出。
- 10個のハートと犬の反応（バブルメッセージ）で表現。
