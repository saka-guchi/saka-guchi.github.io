# ラブラドール学習帳 仕様書

**バージョン:** 53.0
**ターゲット:** Web / PWA
**アーキテクチャ:** マルチページアプリケーション (MPA) / 静的ホスティング

## 1. ファイル構成
- `index.html`: ホーム画面（エントリポイント）
- `quiz.html`: クイズ画面
- `priming.html`: 事前学習画面
- `result.html`: 結果画面
- `list.html`: 単語一覧画面
- `settings.html`: 詳細設定画面
- `style.css`: 共通スタイル
- `app.js`: 共通ロジック（データ読み込み、SRS、セッション管理）
- `words/`: 学習データソースディレクトリ
  - `lists.csv`: データセット一覧定義ファイル
  - `*.csv`: 個別の単語データセット（例: `ngsl.csv`, `ielts3500-basic1000.csv`）
- `Dog.json`: Lottieアニメーションデータ

## 2. データ管理
- **マスターデータ**: `localStorage`。キーはデータセットファイル名に基づき生成される（例: `ngsl.csv` -> `lab_data_v30` (互換性のため), `ielts3500-basic1000.csv` -> `lab_data_ielts`）。
- **データセット定義**: `words/lists.csv` を読み込み、利用可能な単語帳リストを動的に構築する。
  - `lists.csv` のカラム: `file name`, `description`
- **データフォーマット**:
  - 各CSVファイル（`lists.csv`含む）は、全フィールドがダブルコーテーションで囲まれた形式（`"field1","field2",...`）であること。
  - 単語CSVの1行目はヘッダ行（`番号,単語,訳,品詞,例文,訳文`）とし、データは2行目から開始する。
  - **ID生成**: 1列目（番号）に有効な正の整数がある場合はそれをIDとして使用する。ない場合や無効な場合は、1からの連番を使用する。
  - カンマを含むデータ（例文など）も、ダブルコーテーションで囲むことで正しくパースされる。
- **初回ロード**: 選択中のCSVをフェッチし、空であれば `localStorage` を初期化。
- **永続化**: すべての進捗は `localStorage` に保存される。
- **セッション**: `sessionStorage` を使用して、クイズキュー、結果、および学習設定（`lab_session_config`）を管理する。
- **学習統計**:
  - `lab_today_count`: 本日の回答数を保持（`YYYY-MM-DD` 形式の日付とともに管理し、日付変更時にリセット）。

## 3. UI/UX 仕様

### 3.1 共通デザイン
- **ヘッダー**: 画面タイトルのみを表示（ホームボタン削除）。
  - クイズ画面、事前学習画面、結果画面、一覧画面で適用。
  - ホームボタンはフッターや中断ボタンとして配置する。
- **フッター**: 全画面共通で、画面下部に「ホームへ戻る」等のボタンを配置。
- **テーマカラー**: #F4D03F (プライマリ), #5D4037 (テキスト), #FAF9F6 (背景)。
  - ホーム画面の背景色はテーマカラー（#F4D03F）を使用。

### 3.2 ホーム画面 (`index.html`)
- **ヘッダー**: 「ラブラドール学習帳」（絵文字なし）。
- **ビジュアル**:
  - メッセージ「単語を覚えると仲良くなれるよ」。
  - Lottieアニメーション (`Dog.json`) + 親密度ハートメーター（10個）。
  - **親密度メッセージ**:
    - ハートの数（親密度）に応じて、タップ時の犬のセリフが変化。「大好きだワン！」「ずっと一緒だよ！」など愛情表現が豊かになる。
    - **不定期メッセージ**: 5〜15秒のランダムな間隔で、自動的にメッセージが表示される。
- **グラフ**: 「学習効果の持続期間に合わせた出題方法」の分布表示。
  - タイトルをクリックすると独自デザインのモーダルで「レベル別出題形式」のヘルプを表示。
- **設定UI（拡充）**:
  1.  **出題方法 (Method)**:
      - 選択肢: 「おまかせ (推奨)」「英→日」「英→日 (非表示)」「日→英」「例文穴埋め」。
      - ロジック: 「おまかせ」は従来のレベル別アダプティブ。「指定形式」は全問その形式で出題。
  2.  **問題 (Problem)**:
      - 選択肢: 「おまかせ (推奨)」「未学習中心」。
      - ロジック: 「未学習中心」はLv.0を優先。なければ「おまかせ」と同様の挙動（サイレントフォールバック）。
  3.  **問題数 (Limit)**:
      - 選択肢: 10, 20, 30, 40, 50問。
  4.  **制限時間 (Timer)**:
      - 選択肢: 5秒, 10秒, 15秒, 20秒, 25秒。
      - クイズのタイマー初期値として使用。
  5.  **対象レベル**: Lv.0〜Lv.5から選択可能。

### 3.3 単語一覧画面 (`list.html`)
- **タイトル**: 「全単語一覧」。
- **リスト表示**:
  - 1行目: ID, 英単語
  - 2行目: [品詞] 日本語訳
  - 品詞バッジは日本語訳の左側に配置。

### 3.4 事前学習画面 (`priming.html`)
- **リスト表示**:
  - 1行目: 英単語
  - 2行目: [品詞] 日本語訳 + 音声ボタン
  - 品詞バッジは日本語訳の左側に配置。

### 3.5 クイズ画面 (`quiz.html`)
- **ヘッダー**: プログレスバー（上部）、進捗状況（中央）。ホームボタンは削除。
- **UIレイアウト**:
  - **回答ボタン**: 1列表示（`grid-template-columns: 1fr`）、縦4行。
  - **スキップボタン**: 回答エリア左上に配置（不正解扱い）。
  - **アイコン制御**: 「日→英」「例文穴埋め」形式ではマスク・音声アイコンを非表示にし、機能も無効化。
- **回答演出 (インライン)**:
  - オーバーレイ廃止。
  - 正解時: 緑色で **"Good"** / **"Excellent"** を表示。
    - **Excellent判定**: 制限時間の半分以内に回答。
  - 不正解時: 選択ボタンを赤色、正解ボタンを緑色に変更。
- **機能**:
  - マスク機能、音声再生（形式による）。
  - 中断ボタン。

### 3.6 結果画面 (`result.html`)
- **ヘッダー**: 「回答結果」のみ表示。右側に **「本日累計: N問」** を表示。
- **グラフ**: タイトル削除。変動バッジ（+1等）を強調表示。
- **フッターボタン**:
  1.  **同じ問題を復習**: 今回のセッションと同じ単語リストで、**現在のレベル状態**を使って再度学習する。
  2.  **次の問題に進む**: ホームの設定に基づいて新しいセッションを開始。
  3.  **ホームへ戻る**: ホーム画面へ遷移。

### 3.7 詳細設定画面 (`settings.html`)
- **単語帳選択**: データセット切り替え。
- **データ管理**: 学習記録リセット。
- **アプリ更新**: 「アプリを更新（キャッシュクリア）」ボタン（リロード）。

## 4. ロジック仕様

### 4.1 アダプティブクイズ (レベル別出題)
- 「おまかせ」モード時：
  - **Lv.0-1 (Standard)**: 英→日。
  - **Lv.2 (Masked)**: 英→日 (英単語非表示)。
  - **Lv.3 (Reverse)**: 日→英。
  - **Lv.4-5 (Fill-in)**: 例文穴埋め。

### 4.2 SRS (間隔反復) アルゴリズム
- **正解 (Good)**: レベル +1。
- **正解 (Excellent)**: **レベル +3** (最大Lv.5)。
- **復習間隔**:
  - Lv.0: 0日
  - Lv.1: 1日
  - Lv.2: 3日
  - Lv.3: 7日
  - Lv.4: 14日
  - Lv.5: 30日
- **不正解 / スキップ**: レベルリセット（0）、復習間隔を0.5日にリセット。

### 4.3 親密度 (Affinity) システム
- 全単語の合計レベルに基づいて算出。
- 10個のハートと犬の反応（バブルメッセージ）で表現。
