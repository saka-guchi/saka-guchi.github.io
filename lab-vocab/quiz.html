<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„ÇØ„Ç§„Ç∫</title>
    <link rel="stylesheet" href="./style.css">
    <script src="./lottie.min.js"></script>
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#F4D03F">
    <link rel="apple-touch-icon" href="./assets/icon.svg">
    <link rel="icon" type="image/svg+xml" href="./assets/icon.svg">
</head>

<body>

    <!-- iOS PWAÂêë„Åë: „Çø„ÉÉ„Éó„ÅßÈü≥Â£∞API„Çí„Ç¢„É≥„É≠„ÉÉ„ÇØ„Åó„Å¶„Åã„ÇâÈñãÂßã -->
    <div id="start-overlay" class="start-overlay">
        <div class="start-overlay-content">
            <div class="start-overlay-icon">üéß</div>
            <div class="start-overlay-text">„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã</div>
            <div class="start-overlay-note">‚ÄªÈü≥Â£∞„ÅåÊµÅ„Çå„Åæ„Åô</div>
        </div>
    </div>

    <div id="quiz-screen" class="screen" style="display:none;">
        <div class="progress-bar-container">
            <div class="progress-bar" id="timer-bar"></div>
        </div>

        <div class="screen-header" style="position:relative; justify-content:center; min-height:40px;">
            <div class="quiz-status" id="quiz-progress" style="position:absolute; left:10px;">- / -</div>
            <div id="inline-feedback" class="inline-feedback" style="margin:0; height:auto; min-height:24px;"></div>
        </div>

        <div class="quiz-header-container" style="justify-content:center; margin-top:10px;">
            <div class="quiz-level-badge" id="quiz-level-display">Lv.0</div>
        </div>

        <div class="word-card">
            <img id="feedback-icon" class="feedback-icon" src="" alt="" style="display:none;">
            <div class="word-row">
                <button class="icon-btn" id="mask-toggle-btn" onclick="app.toggleMask()">üëÅÔ∏è</button>
                <div style="display:flex; flex-direction:column; align-items:center; flex:1;">
                    <div class="question-text" id="q-text">Loading...</div>
                    <div id="pos-badge" class="pos-badge" style="background:#eee;color:#888;margin-top:5px;">Pos</div>
                    <div class="question-sub" id="q-sub"></div>
                </div>
                <button class="icon-btn" id="speaker-btn" onclick="app.replaySpeak()">üîä</button>
            </div>
        </div>

        <div style="width:100%; position:relative; padding-top:10px;">
            <button id="skip-btn" class="skip-btn" onclick="app.answer(false, null)">
                <span class="icon-sm" style="width:14px; height:14px;"><svg viewBox="0 0 24 24">
                        <polygon points="5 4 15 12 5 20 5 4"></polygon>
                        <line x1="19" y1="5" x2="19" y2="19"></line>
                    </svg></span>„Çπ„Ç≠„ÉÉ„Éó
            </button>
            <div class="choices-container" id="choices-area"></div>
        </div>

        <button class="btn-home" style="margin-top:20px;" onclick="app.confirmHome()">‰∏≠Êñ≠„Åó„Å¶„Éõ„Éº„É†„Å∏</button>
    </div>

    <script src="./app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('SW registered!', reg))
                .catch(err => console.log('SW failed', err));
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('start-overlay');
            overlay.addEventListener('click', () => {
                // iOS„ÅßSpeechSynthesis„Çí„Ç¢„É≥„É≠„ÉÉ„ÇØÔºà„É¶„Éº„Ç∂„Éº„Ç¢„ÇØ„Ç∑„Éß„É≥‰∏≠„Å´ÂÆüË°åÔºâ
                app.unlockSpeech();
                overlay.style.display = 'none';
                document.getElementById('quiz-screen').style.display = 'flex';
                app.init();
            }, { once: true });
        });
    </script>
</body>

</html>